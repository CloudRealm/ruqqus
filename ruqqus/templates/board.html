{% extends "home.html" %}

{% block submit_param %}?guild={{ b.name | urlencode }}{% endblock %}

{% block PseudoSubmitForm %}
<!-- Link to submission page from guild -->

<div class="row no-gutters d-none d-lg-flex">

  <div class="col">
    <div class="card pseudo-submit-form">
      <div class="card-header bg-white">
        <div class="text-small text-gray mb-0">Create post in +{{ b.name }}</div>
        <ul class="list-inline no-bullets mb-0 d-none">
          <li class="list-inline-item active mr-4"><i class="fas fa-align-left text-gray-400"></i></li>
          <li class="list-inline-item"><i class="fas fa-link text-gray-400"></i></li>
        </ul>
      </div>
      <div class="card-body">
        {% if v and not is_subscribed %}
        <a href="/submit?guild={{ b.name | urlencode }}">
          <input type="text" class="form-control"
          placeholder="Share something with this guild..." aria-label="Username"
          aria-describedby="basic-addon1">
        </a>
        {% elif v and is_subscribed %}
        <a href="/submit?guild={{ b.name | urlencode }}">
          <input type="text" class="form-control"
          placeholder="Share something with your guild..." aria-label="Username"
          aria-describedby="basic-addon1">
        </a>
        {% else %}
        <a href="/signup">
          <input type="text" class="form-control"
          placeholder="Share something with this guild..." aria-label="Username"
          aria-describedby="basic-addon1">
        </a>
        {% endif %}
      </div>
    </div>
  </div>

</div>
{% endblock %}

{% block banner %}
<div class="jumbotron jumbotron-fluid jumbotron-guild text-white" style="background-image: url({{ b.banner_url }})">
  <div class="jumbotron-overlay"></div>
  <div class="position-absolute w-100 p-3" style="bottom: 0;">
  <div class="container">
      <div class="d-md-flex text-center text-md-left">
        <div>
          <img src="{{ b.profile_url }}" class="guild-icon-square-lg">
        </div>
        <div class="ml-3 w-100">
          <h1 class="h3 d-inline-block mr-2">+{{ b.name }}
           {% if b.over_18 %}
           <span class="badge badge-danger text-small align-middle">NSFW</span>
           {% endif %}
         </h1>
         <div><span class="font-weight-bold">{{ b.subscriber_count }}</span> member{{ 's' if b.subscriber_count != 1 else '' }}<span> Â· </span>
           <span class="font-weight-bold" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="{{ b.created_date }}">{{ b.age_string }}</span> est.
         </div>
         <div class="mt-1">{{ b.description_html | safe }}</div>
         <div class="d-flex">
           <div class="w-100">
             {% for mod in b.mods %}
             <a href="{{ mod.permalink }}" class="profile-pic-overlap"><div class="profile-pic-30 border-2 border-white rounded-circle d-inline-block" style="background-color:#{{ mod.color }}"><span class="letter text-white">{{ mod.username[0] }}</span></div></a>
             {% else %}
             No guildmasters
             {% endfor %}
           </div>
           {% if v %}
           <div id="button-sub" {% if is_subscribed %}class="d-none"{% endif %}><a class="btn btn-primary btn-block" href="javascript:void(0)" onclick="post('/api/subscribe/{{ b.name }}', callback=function(){document.getElementById('button-unsub').classList.toggle('d-none');document.getElementById('button-sub').classList.toggle('d-none');})">Join +{{ b.name }}</a></div>
           <div id="button-unsub" {% if not is_subscribed %}class="d-none"{% endif %}><a class="btn btn-secondary btn-block" href="javascript:void(0)" onclick="post('/api/unsubscribe/{{ b.name }}', callback=function(){document.getElementById('button-unsub').classList.toggle('d-none');document.getElementById('button-sub').classList.toggle('d-none');})">Leave +{{ b.name }}</a></div>
           {% endif %}
         </div>
       </div>
     </div>
   </div>
 </div>
</div>
{% endblock %}

{% block adminpanel %}
{% endblock %}

{% block sidebarblock %}
<div class="sidebar-section sidebar-info-basic">
  <div class="body pb-0">
   {% if b.fa_icon %}
   <div class="body text-primary text-center"><i class="{{ b.fa_icon }}" style="font-size:4rem"></i></div>
   {% endif %}
   <h1 class="h6 d-inline-block">+{{ b.name }}</h1>
   <div><span data-toggle="tooltip" data-placement="bottom" title="" data-original-title="{{ b.created_date }}" class="text-muted"><i class="fad fa-calendar-day fa-width-rem text-muted"></i> Founded {{ b.age_string }}</span></div>
   <div><span class="text-muted"><i class="fad fa-users fa-width-rem"></i> {{ b.subscriber_count }} Member{{ 's' if b.subscriber_count != 1 else '' }}</span></div>
 </div>
 {% if b.over_18 %}
 <div class="body">
  <span class="badge badge-danger text-small align-middle">NSFW</span>
</div>
{% endif %}
<div class="body pt-0">
  {{ b.description_html | safe }}
</div>
</div>
{% if v and not b.has_ban(v) %}
<div class="sidebar-section sidebar-submit">
  <div class="body">
    <div class="title">Submit to +{{ b.name }}</div>
    <a class="btn btn-primary btn-block" href="/submit?guild={{ b.name | urlencode }}">Create Post in +{{ b.name }}</a>
  </div>
</div>
{% endif %}
<div class="sidebar-section sidebar-mods">
  <div class="body">
    <div class="title">Guildmasters</div>
    <ul>
      {% for mod in b.mods %}
      <li><a href="{{ mod.permalink }}">@{{ mod.username }}</a></li>
      {% else %}
      <li>None</li>
      {% endfor %}
    </ul>
  </div>
</div>
{% if v and b.has_mod(v) %}
<div class="sidebar-section sidebar-guild-tools">
  <div class="body pt-0">
    <div class="title">Guildmaster Tools</div>
    <div><a href="{{ b.permalink}}/mod/settings"><i class="fad fa-cog fa-width-rem"></i>Settings</a></div>
    <div><a href="{{ b.permalink}}/mod/mods"><i class="fad fa-user-crown fa-width-rem"></i>Guildmasters</a></div>
    <div><a href="{{ b.permalink}}/mod/exiled"><i class="fad fa-gavel fa-width-rem"></i>Exiles</a></div>
    <div><a href="{{ b.permalink}}/mod/queue"><i class="fad fa-flag fa-width-rem"></i>Reports</a></div>
  </div>
</div>
{% endif %}
{% endblock %}

{% block sidebarLeftblock %}

{% if not v %}
<div class="sidebar-section sidebar-alert">
  <div class="body">
    {% if b.fa_icon %}
    <i class="{{ b.fa_icon }} text-primary mb-3" style="font-size: 3rem;"></i>
    {% endif %}
    <h4>Jump into the discourse of <span class="text-primary">+{{ b.name }}</span></h4>
    <p class="text-small">A Ruqqus account lets you be a part of your favorite communities.</p>
    <a href="/signup" class="btn btn-primary btn-block">Sign up</a>
  </div>
</div>
{% endif %}

{% if v %}

<div class="sidebar-section sidebar-dashboard">
  <div class="body">
    <div class="title">Dashboard</div>
    <ul class="no-bullets dashboard-list pl-0 mb-0">
      <li class="dashboard-item">
        <a class="dashboard-link" href="/"><i class="fas fa-home-alt fa-width-rem"></i>Home</a>
      </li>
      <li class="dashboard-item">
       <a class="dashboard-link" href="/guilds"><i class="fas fa-university fa-width-rem"></i>Guilds</a>
     </li>
     <li class="dashboard-item">
       <a class="dashboard-link" href="/subscriptions"><i class="fas fa-heart fa-width-rem"></i>Subscriptions</a>
     </li>
     <li class="dashboard-item">
      <a class="dashboard-link" href="/browse"><i class="fas fa-binoculars fa-width-rem"></i>Browse</a>
    </li>
  </ul>
</div>
</div>

{% endif %}

{% if not v and trending_boards %}
<div class="sidebar-section sidebar-guild-recommendations sticky-63">
  <div class="body">
    <div class="title">Rising Guilds</div>
    <ul class="no-bullets guild-recommendations-list pl-0">
     {% for entry in trending_boards[0:5] %}
     <li class="guild-recommendations-item">
      <a href="{{ entry[0].permalink }}">
        <div class="d-flex">
          <div class="mr-2">
            <img src="{{ entry.profile_url }}" class="guild-icon-square-35"></div>
            <div>
              <div class="text-black font-weight-normal">+{{ entry[0].name }}</div>
              <div class="text-muted text-small font-weight-normal">{{ entry[1] }} Member{{ '' if entry[1]==1 else 's' }}</div>
            </div>
          </div>
        </a>
      </li>
      {% endfor %}
    </ul>
  </div>
</div>
{% elif v and v.subscriptions.filter_by(is_active=True).count() %}
<div class="sidebar-section sidebar-guild-recommendations sticky-63">
  <div class="body">
    <div class="title">My Guilds</div>
    <ul class="no-bullets guild-recommendations-list pl-0">
      {% for board in v.boards_subscribed[0:8] %}
      <li class="guild-recommendations-item">
        <a href="{{ board.permalink }}">
          <div class="d-flex">
            <div class="mr-2">
              <img src="{{ board.profile_url }}" class="guild-icon-square-35"></div>
              <div class="my-auto">
                <div class="text-black font-weight-normal">+{{ board.name }}</div>
              </div>
            </div>
          </a>
        </li>
        {% endfor %}
      </ul>
    </div>
  </div>
  {% elif v and not v.subscriptions.filter_by(is_active=True).count() %}
  <div class="sidebar-section sidebar-guild-recommendations sticky-63">
    <div class="body">
      <div class="title">Guilds</div>
      <div class="my-3" style="">
        <i class="fad fa-telescope text-primary" style="font-size:3rem"></i>
      </div>
      <h5>Discover amazing communities across Ruqqus.</h5>
      <p class="text-small">You are not a member of any guilds. Guilds you are a member of will be displayed here.</p>
      <a href="/browse" class="btn btn-primary btn-block">Discover guilds</a>
    </div>
  </div>
  {% endif %}

  {% endblock %}

  {% block pagetype %}guild{% endblock %}

  {% block title %}
  <title>+{{ b.name }} - Ruqqus</title>
  <meta name="description" content="+{{ b.name }}">
  {% endblock %}

  {% block enlargeThumbJS %}
  <script src="/assets/js/enlarge_thumb.js"></script>
  {% endblock %}

  {% block fixedMobileBarJS %}
  <script>
    var prevScrollpos = window.pageYOffset;
    window.onscroll = function () {
      var currentScrollPos = window.pageYOffset;
      if (prevScrollpos > currentScrollPos) {
        document.getElementById("fixed-bar-mobile").style.top = "49px";
        document.getElementById("navbar").classList.remove("shadow");
      } 
      else if (currentScrollPos <= 125) {
        document.getElementById("fixed-bar-mobile").style.top = "49px";
        document.getElementById("navbar").classList.remove("shadow");
      }
      else {
        document.getElementById("fixed-bar-mobile").style.top = "-49px";
        document.getElementById("dropdownMenuSortBy").classList.remove('show');
        document.getElementById("dropdownMenuFrom").classList.remove('show');
        document.getElementById("navbar").classList.add("shadow");
      }
      prevScrollpos = currentScrollPos;
    }
  </script>
  {% endblock %}
